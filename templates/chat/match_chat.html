{% load static %}

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 비서와의 여행 매칭 & 채팅</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/chat_style.css' %}">
</head>
<body>
    <script>
        // 장고 템플릿 태그를 사용하여 변수를 JS 변수에 할당합니다.
        const MY_USERNAME = "{{ request.user.username|default:'Guest' }}"; 
    </script>
    
    <div id="app-container">
        <aside id="sidebar" class="partner-list-container">
            <header>
                <h2><i class="fas fa-users-line"></i> 파트너 매칭 목록</h2>
            </header>
            <ul id="match-list" class="match-list">
                {% if message %}
                <p style="text-align:center; color: #ff6b6b; font-weight:bold;">
                    {{ message }}
                </p>
                 {% endif %}
                {% for partner in partners %}
                    <li class="partner-card" data-room-id="{{ partner.id }}">
                        <div style="display: flex; align-items: center;">
                            <img src="{% static 'images/default-avatar.png' %}" alt="{{ partner.name }} 아바타" style="width:40px; height:40px; border-radius:50%; margin-right:10px;">
                            <div>
                                <strong class="partner-name">{{ partner.name }}</strong>
                                <p style="margin:0; font-size:0.8em; color:#777;">{{ partner.trip }}</p>
                            </div>
                        </div>
                    </li>
                {% empty %}
                    <p style="text-align: center; padding: 20px;">매칭된 파트너가 없습니다.</p>
                {% endfor %}
            </ul>
        </aside>

        <main id="chat-area" class="chat-main-container hidden">
            <header class="chat-header">
                <div id="partner-info">
                    <img id="partner-avatar" src="{% static 'images/default-avatar.png' %}" alt="파트너 아바타">
                    <span id="partner-name">여행 파트너 선택</span>
                </div>
                <div class="chat-actions">
                    <button class="action-btn" title="여행 계획 보기"><i class="fas fa-map-location-dot"></i></button>
                    <button id="back-to-list-btn" class="action-btn back-btn" title="목록으로"><i class="fas fa-arrow-left"></i></button>
                </div>
            </header>

            <div id="chat-box" class="chat-box"></div>

            <footer class="chat-input-form">
                <input type="text" id="msg-input" placeholder="메시지를 입력하세요..." autocomplete="off">
                <button id="send-btn" title="전송"><i class="fas fa-paper-plane"></i></button>
            </footer>
        </main>
    </div>

    <script src="{% static 'script/chat_script.js' %}"></script>
</body>
</html>